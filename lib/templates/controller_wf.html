var cwd = process.cwd();

var wfFactory = require('aquajs-wf-runner').Factory;  
  // get factory object this is used to add jobs to backend

var AquaWorkFlow = require('aquajs-wf-runner').AquaWorkFlow;
  // get aqua workflow  object, this is the key object
  
var wfConfig = require(dirPaths.configDir+'/workflow/config.json');  
  // should match with worker configurations

wfConfig.workflowsDirectory = dirPaths.serverDir+"/workflows/{{ controllerName | replace('Controller', '') }}";

var wf = new AquaWorkFlow(wfConfig,wfFactory);  
  //create wf object and re-use everytime a request comes in

var {{ controllerName }} = {
  {%- for apiMethod in apiMethods -%}
    {%- for operation in apiMethod.operations -%}

        {{ operation.nickname }}: function (req, res) {
          try {
              wf.startJob("{{ controllerName | replace('Controller', '') }}.{{ operation.nickname }}",{ body:req.params, url: req.url }, 
              function(err, obj) {
                // Workflow Completed

                if (err || obj == "Error" || obj.execution != 'succeeded') {
                    res.status(404).send(obj.result);
                } else {
                    res.header("Content-Type", "application/json; charset=utf-8");
                    res.send(obj.result);
                }
              }, 
              function(err, data) {
                // Workflow failed
                  if (err) {
                      res.status(404).send('Not found');
                  }
                  else {
                  }
              });
          }
          catch(ex){
              console.log(ex);
          }
        }
        {%- if loop.length >1 and !loop.last -%}
             ,
        {%- endif -%}

    {%- endfor -%}
    {%- if loop.length >1 and !loop.last -%}
         ,
    {%- endif -%}
  {%- endfor -%}
}
module.exports = {{ controllerName }};




